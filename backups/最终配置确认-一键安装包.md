# 最终配置确认 - 一键安装包

> 生成时间：2026-02-20  
> 目标：确认 electron-builder 配置符合一键安装要求

---

## A. electron-builder 输出配置确认

### 1. NSIS 配置

```json
{
  "nsis": {
    "oneClick": true,                          // ✅ 一键安装
    "allowToChangeInstallationDirectory": false, // ✅ 不允许选择目录
    "perMachine": false,                        // ✅ 安装到用户目录（不需要管理员）
    "allowElevation": true,                    // ✅ 允许提升权限（如果需要）
    "createDesktopShortcut": "always",         // ✅ 创建桌面快捷方式
    "createStartMenuShortcut": true,            // ✅ 创建开始菜单快捷方式
    "shortcutName": "仓库管理",                 // ✅ 快捷方式名称
    "include": "build/installer.nsh",          // ✅ 自定义安装脚本
    "installerLanguages": ["zh_CN"],           // ✅ 中文界面
    "language": "2052",                         // ✅ 中文语言代码
    "runAfterFinish": false,                    // ✅ 安装后不自动运行
    "artifactName": "${productName}-${version}-Setup.${ext}" // ✅ 安装包命名
  }
}
```

### 2. ASAR 配置

```json
{
  "asar": true,                                // ✅ 启用 ASAR 打包
  "asarUnpack": [
    "**/better-sqlite3/**/*",                 // ✅ better-sqlite3 解包
    "**/server/dist/**/*",                     // ✅ 后端编译产物解包
    "**/*.node"                                // ✅ 所有 native 模块解包
  ]
}
```

### 3. Windows Target 配置

```json
{
  "win": {
    "target": [
      {
        "target": "nsis",                      // ✅ NSIS 安装包
        "arch": ["x64"]                         // ✅ x64 架构
      }
    ],
    "icon": "public/icon.ico",                 // ✅ 图标
    "requestedExecutionLevel": "asInvoker",     // ✅ 不需要管理员权限
    "publisherName": "仓库管理系统"             // ✅ 发布者名称
  }
}
```

### 4. predist:win 钩子确认

```json
{
  "scripts": {
    "rebuild:native": "electron-rebuild -f -w better-sqlite3",
    "predist:win": "npm run rebuild:native"    // ✅ 打包前自动 rebuild
  }
}
```

---

## B. 一键构建命令（PowerShell）

```powershell
cd "D:\仓库管理\warehouse-app"
Remove-Item -Recurse -Force node_modules, server\dist, dist-electron, dist -ErrorAction SilentlyContinue
npm install
npm run server:build
npm run compile
npm run build
npm run dist:win
```

**或使用批处理脚本**：
```batch
build-scripts\一键构建并生成安装包.bat
```

---

## C. 安装包输出位置

**构建输出**：`dist\仓库管理-1.0.0-Setup.exe`  
**最终位置**：`build-scripts\仓库管理-1.0.0-Setup.exe`

---

## D. 验证步骤

1. **双击安装包**：`build-scripts\仓库管理-1.0.0-Setup.exe`
2. **自动安装**：无需选择目录，自动完成安装
3. **启动应用**：从桌面或开始菜单启动
4. **验证健康端点**：`http://127.0.0.1:41731/api/health`
5. **验证数据库**：`%APPDATA%\warehouse-app\warehouse.db`
6. **验证日志**：`%APPDATA%\warehouse-app\logs\app-*.log`

---

**配置已确认，可以开始构建！** ✅
