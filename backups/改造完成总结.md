# Windows 10/11 å®‰è£…åŒ…æ”¹é€ å®Œæˆæ€»ç»“

> å®Œæˆæ—¶é—´ï¼š2026-02-20  
> ç›®æ ‡ï¼šå°† Linux å·¥ç¨‹æ”¹é€ æˆ Windows 10/11 å¯å®‰è£… .exeï¼ˆNSISï¼‰

---

## âœ… æ”¹é€ å®Œæˆæ¸…å•

### STEP 0: å¿«é€Ÿä½“æ£€ âœ…
- [x] è¾“å‡ºå½“å‰å…³é”®é…ç½®ï¼ˆè§ `backups/STEP0-ä½“æ£€æŠ¥å‘Š.md`ï¼‰

### STEP 1: æ”¹é€ åç«¯ âœ…
- [x] åˆ›å»º `server/tsconfig.build.json`ï¼ˆåç«¯ç¼–è¯‘é…ç½®ï¼‰
- [x] æ–°å¢ `server:build` è„šæœ¬ï¼ˆç¼–è¯‘åç«¯ TS -> JSï¼‰
- [x] æ–°å¢ `server:clean` è„šæœ¬ï¼ˆæ¸…ç†ç¼–è¯‘äº§ç‰©ï¼‰
- [x] ä¿®æ”¹ Electron ä¸»è¿›ç¨‹ï¼šç”Ÿäº§ç¯å¢ƒè¿è¡Œ `server/dist/index.js`ï¼ˆä¸å†ä½¿ç”¨ tsxï¼‰

### STEP 2: è§£å†³ better-sqlite3 âœ…
- [x] å®‰è£… `electron-rebuild`ï¼ˆdevDependenciesï¼‰
- [x] æ–°å¢ `rebuild:native` è„šæœ¬
- [x] æ–°å¢ `postinstall` é’©å­ï¼ˆè‡ªåŠ¨ rebuildï¼‰

### STEP 3: electron-builder é…ç½®ä¼˜åŒ– âœ…
- [x] `files` åŒ…å« `server/dist/**/*`ï¼ˆåç«¯ç¼–è¯‘äº§ç‰©ï¼‰
- [x] `files` æ’é™¤ `server/**/*.ts`ï¼ˆTS æºæ–‡ä»¶ï¼‰
- [x] `extraResources` æ”¹ä¸º `server/dist`ï¼ˆåªå¤åˆ¶ç¼–è¯‘äº§ç‰©ï¼‰
- [x] `asarUnpack` æ”¹ä¸º `**/server/dist/**/*`ï¼ˆè§£åŒ…ç¼–è¯‘äº§ç‰©ï¼‰
- [x] `asarUnpack` æ–°å¢ `**/*.node`ï¼ˆä¿é™©èµ·è§ï¼‰

### STEP 4: ç¨³å®šå¯åŠ¨æµç¨‹ âœ…
- [x] æ”¹è¿›å¥åº·æ£€æŸ¥è¶…æ—¶ï¼ˆ15 ç§’ï¼Œè®°å½•æ—¥å¿—è·¯å¾„ï¼‰
- [x] æ”¹è¿›é”™è¯¯å¤„ç†ï¼ˆæ˜¾ç¤ºæ—¥å¿—è·¯å¾„ï¼‰
- [x] åç«¯ç«¯å£æ”¯æŒç¯å¢ƒå˜é‡ï¼ˆ`process.env.PORT`ï¼‰
- [x] ç«¯å£å ç”¨è‡ªåŠ¨åˆ‡æ¢ï¼ˆ41732-41740ï¼‰

### STEP 5: Windows å®‰è£…å™¨å¼ºåŒ– âœ…
- [x] æ•°æ®åº“è·¯å¾„æ”¹ä¸º `%APPDATA%\warehouse-app\warehouse.db`
- [x] NSIS å¸è½½æç¤ºä¿ç•™ç”¨æˆ·æ•°æ®
- [x] åç«¯å›ºå®šç›‘å¬ `127.0.0.1`ï¼ˆé¿å…é˜²ç«å¢™å¼¹çª—ï¼‰

### STEP 6: ä¸€é”®æ„å»ºå‘½ä»¤ âœ…
- [x] åˆ›å»º `build-scripts/ä¸€é”®æ„å»º-Windows.bat`
- [x] åˆ›å»º `build-scripts/ä¸€é”®æ„å»ºå‘½ä»¤.md`ï¼ˆè¯¦ç»†æ–‡æ¡£ï¼‰

### STEP 7: å…³é”®æ–‡ä»¶ diff âœ…
- [x] è¾“å‡ºæ‰€æœ‰å…³é”®æ–‡ä»¶ä¿®æ”¹æ€»ç»“ï¼ˆè§ `backups/STEP7-å…³é”®æ–‡ä»¶ä¿®æ”¹æ€»ç»“.md`ï¼‰

---

## ğŸ“¦ ä¸€é”®æ„å»ºå‘½ä»¤ï¼ˆå¯å¤åˆ¶ï¼‰

### Windows PowerShell

```powershell
cd "d:\ä»“åº“ç®¡ç†\warehouse-app"

# 1. å®‰è£…ä¾èµ–
npm install

# 2. ç¼–è¯‘åç«¯ï¼ˆTypeScript -> JavaScriptï¼‰
npm run server:build

# 3. é‡å»ºåŸç”Ÿæ¨¡å—ï¼ˆbetter-sqlite3 for Electronï¼‰
npm run rebuild:native

# 4. ç¼–è¯‘ Electron ä¸»è¿›ç¨‹
npm run compile

# 5. æ„å»ºå‰ç«¯
npm run build

# 6. æ„å»º Windows å®‰è£…åŒ…
npm run dist:win
```

### æˆ–ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ¨èï¼‰

```batch
# åŒå‡»è¿è¡Œ
build-scripts\ä¸€é”®æ„å»º-Windows.bat
```

---

## ğŸ“ è¾“å‡ºäº§ç‰©è·¯å¾„

**å®‰è£…åŒ…**ï¼š
```
dist\ä»“åº“ç®¡ç†-1.0.0-Setup.exe
```

**æ„å»ºä¸­é—´äº§ç‰©**ï¼š
- `server/dist/` - åç«¯ç¼–è¯‘åçš„ JavaScript
- `dist-electron/` - Electron ä¸»è¿›ç¨‹ç¼–è¯‘äº§ç‰©
- `dist/` - å‰ç«¯æ„å»ºäº§ç‰©ï¼ˆé™æ€æ–‡ä»¶ï¼‰

---

## âœ… éªŒè¯æ­¥éª¤

### 1. å®‰è£…åå¯åŠ¨åº”ç”¨

åŒå‡»å®‰è£…åŒ…ï¼š`dist\ä»“åº“ç®¡ç†-1.0.0-Setup.exe`

### 2. æ£€æŸ¥å¥åº·ç«¯ç‚¹

```powershell
Invoke-WebRequest -Uri "http://127.0.0.1:41731/api/health" -UseBasicParsing
```

**é¢„æœŸå“åº”**ï¼š`{"status":"ok"}`

### 3. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶ä½ç½®

```powershell
Test-Path "$env:APPDATA\warehouse-app\warehouse.db"
Get-Item "$env:APPDATA\warehouse-app\warehouse.db" | Select-Object FullName, Length
```

**é¢„æœŸä½ç½®**ï¼š`C:\Users\<ç”¨æˆ·å>\AppData\Roaming\warehouse-app\warehouse.db`

### 4. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶

```powershell
Get-ChildItem "$env:APPDATA\warehouse-app\logs\" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
```

---

## ğŸ¯ å…³é”®ç‰¹æ€§ç¡®è®¤

### âœ… ç”Ÿäº§ç¯å¢ƒè¿è¡Œç¼–è¯‘åçš„ JS
- ä¸å†ä½¿ç”¨ `tsx server/index.ts`
- è¿è¡Œ `node server/dist/index.js`

### âœ… better-sqlite3 electron-rebuild
- ä½¿ç”¨ `electron-rebuild` é‡å»º native æ¨¡å—
- ç¡®ä¿ ABI å…¼å®¹æ€§

### âœ… ç”¨æˆ·æ•°æ®è·¯å¾„
- Windows: `%APPDATA%\warehouse-app\warehouse.db`
- Linux/Mac: `~/.warehouse-app/warehouse.db`
- å¸è½½ä¸åˆ é™¤ç”¨æˆ·æ•°æ®

### âœ… é˜²ç«å¢™æœ€å°åŒ–
- åç«¯å›ºå®šç›‘å¬ `127.0.0.1`ï¼ˆä¸æ˜¯ `0.0.0.0`ï¼‰
- é¿å…é˜²ç«å¢™å¼¹çª—

### âœ… ç«¯å£è‡ªåŠ¨åˆ‡æ¢
- é»˜è®¤ç«¯å£ï¼š41731
- å ç”¨æ—¶è‡ªåŠ¨å°è¯•ï¼š41732-41740

### âœ… å¥åº·æ£€æŸ¥æ”¹è¿›
- è¶…æ—¶ï¼š15 ç§’ï¼ˆåŸ 30 ç§’ï¼‰
- å¤±è´¥æ—¶æ˜¾ç¤ºæ—¥å¿—è·¯å¾„

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `backups/STEP0-ä½“æ£€æŠ¥å‘Š.md` - å½“å‰é…ç½®ä½“æ£€
- `backups/STEP7-å…³é”®æ–‡ä»¶ä¿®æ”¹æ€»ç»“.md` - æ‰€æœ‰ä¿®æ”¹è¯¦æƒ…
- `build-scripts/ä¸€é”®æ„å»ºå‘½ä»¤.md` - è¯¦ç»†æ„å»ºæ–‡æ¡£

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•æ„å»º**ï¼šè¿è¡Œ `build-scripts\ä¸€é”®æ„å»º-Windows.bat`
2. **éªŒè¯å®‰è£…åŒ…**ï¼šå®‰è£…å¹¶æµ‹è¯•åº”ç”¨
3. **æ£€æŸ¥æ—¥å¿—**ï¼šç¡®è®¤åç«¯å¯åŠ¨æ­£å¸¸
4. **éªŒè¯æ•°æ®åº“**ï¼šç¡®è®¤æ•°æ®åº“æ–‡ä»¶ä½ç½®æ­£ç¡®

---

**æ”¹é€ å®Œæˆï¼å¯ä»¥å¼€å§‹æ„å»º Windows å®‰è£…åŒ…äº†ï¼** âœ…
